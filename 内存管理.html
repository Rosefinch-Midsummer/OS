<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>内存管理 - 操作系统</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="前言.html"><strong aria-hidden="true">1.</strong> 前言</a></li><li class="chapter-item expanded "><a href="计算机系统概述.html"><strong aria-hidden="true">2.</strong> 计算机系统概述</a></li><li class="chapter-item expanded "><a href="进程管理.html"><strong aria-hidden="true">3.</strong> 进程管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="进程与线程.html"><strong aria-hidden="true">3.1.</strong> 进程与线程</a></li><li class="chapter-item expanded "><a href="进程管理.html"><strong aria-hidden="true">3.2.</strong> 进程管理</a></li><li class="chapter-item expanded "><a href="进程同步.html"><strong aria-hidden="true">3.3.</strong> 同步与互斥</a></li><li class="chapter-item expanded "><a href="死锁.html"><strong aria-hidden="true">3.4.</strong> 死锁</a></li></ol></li><li class="chapter-item expanded "><a href="存储管理.html"><strong aria-hidden="true">4.</strong> 存储管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="内存管理.html" class="active"><strong aria-hidden="true">4.1.</strong> 内存管理</a></li><li class="chapter-item expanded "><a href="虚拟内存.html"><strong aria-hidden="true">4.2.</strong> 虚拟内存</a></li></ol></li><li class="chapter-item expanded "><a href="文件管理.html"><strong aria-hidden="true">5.</strong> 文件管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="文件系统基础.html"><strong aria-hidden="true">5.1.</strong> 文件系统基础</a></li><li class="chapter-item expanded "><a href="目录.html"><strong aria-hidden="true">5.2.</strong> 目录</a></li><li class="chapter-item expanded "><a href="文件系统.html"><strong aria-hidden="true">5.3.</strong> 文件系统</a></li></ol></li><li class="chapter-item expanded "><a href="IO管理.html"><strong aria-hidden="true">6.</strong> I/O管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="IO管理概述.html"><strong aria-hidden="true">6.1.</strong> I/O 管理概述</a></li><li class="chapter-item expanded "><a href="IO核心子系统.html"><strong aria-hidden="true">6.2.</strong> I/O核心子系统</a></li><li class="chapter-item expanded "><a href="磁盘与固态硬盘.html"><strong aria-hidden="true">6.3.</strong> 磁盘与固态硬盘</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">操作系统</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="内存管理"><a class="header" href="#内存管理">内存管理</a></h1>
<ul>
<li><a href="#%E5%86%85%E5%AD%98%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86">内存的基础知识</a></li>
<li><a href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9A%84%E6%A6%82%E5%BF%B5">内存管理的概念</a></li>
<li><a href="#%E8%A6%86%E7%9B%96%E4%B8%8E%E4%BA%A4%E6%8D%A2">覆盖与交换</a></li>
<li><a href="#%E8%BF%9E%E7%BB%AD%E5%88%86%E9%85%8D%E7%AE%A1%E7%90%86">连续分配管理</a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95">动态分区分配算法</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86%E7%9A%84%E6%A6%82%E5%BF%B5">基本分页存储管理的概念</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E6%9C%BA%E6%9E%84">基本地址变换机构</a></li>
<li><a href="#%E5%85%B7%E6%9C%89%E5%BF%AB%E8%A1%A8%E7%9A%84%E5%9C%B0%E5%9D%80%E5%8F%98%E6%8D%A2%E6%9C%BA%E6%9E%84">具有快表的地址变换机构</a></li>
<li><a href="#%E4%B8%A4%E7%BA%A7%E9%A1%B5%E8%A1%A8">两级页表</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%88%86%E6%AE%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F">基本分段存储管理方式</a></li>
<li><a href="#%E6%AE%B5%E9%A1%B5%E5%BC%8F%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F">段页式管理方式</a></li>
</ul>
<h2 id="内存的基础知识"><a class="header" href="#内存的基础知识">内存的基础知识</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626213718.png" alt="" /></p>
<p>进程运行的基本原理</p>
<p>（1）指令的工作原理---操作码+若干参数（可能包含地址参数）</p>
<p>（2）逻辑地址（相对地址）vs物理地址（绝对地址）</p>
<p>（3）从写程序到程序运行---编译、链接、装入</p>
<p>（4）装入模块装入内存</p>
<p>（5）装入的三种方式</p>
<p>①绝对装入</p>
<p>②静态重定位</p>
<p>③ 动态重定位</p>
<p>（6）链接的三种方式</p>
<p>① 静态链接</p>
<p>②装入时动态链接</p>
<p>③运行时动态链接</p>
<h2 id="内存管理的概念"><a class="header" href="#内存管理的概念">内存管理的概念</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626213800.png" alt="" /></p>
<h2 id="覆盖与交换"><a class="header" href="#覆盖与交换">覆盖与交换</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626213857.png" alt="" /></p>
<h2 id="连续分配管理"><a class="header" href="#连续分配管理">连续分配管理</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626213935.png" alt="" /></p>
<h2 id="动态分区分配算法"><a class="header" href="#动态分区分配算法">动态分区分配算法</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626214134.png" alt="" /></p>
<h2 id="基本分页存储管理的概念"><a class="header" href="#基本分页存储管理的概念">基本分页存储管理的概念</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626214321.png" alt="" /></p>
<h2 id="基本地址变换机构"><a class="header" href="#基本地址变换机构">基本地址变换机构</a></h2>
<p>基本地址变换机构可以借助进程的页表将逻辑地址转换为物理地址。</p>
<p>通常会在系统中设置一个页表寄存器（PTR），存放页表在内存中的起始地址F和页表长度M。
进程未执行时，页表的始址和页表长度放在进程控制块（PCB）中，当进程被调度时，操作系
统内核会把它们放到页表寄存器中。</p>
<p>注意：页面大小是2的整数幂</p>
<p>设页面大小为L，逻辑地址A到物理地址E的变换过程如下：</p>
<p>①计算页号P和页内偏移量W（如果用十进制数手算，则P=A/L，W=A%L；但是在计算机实际
运行时，逻辑地址结构是固定不变的，因此计算机硬件可以更快地得到二进制表示的页号、页
内偏移量)</p>
<p>②比较页号P和页表长度M，若P≥M，则产生越界中断，否则继续执行。（注意：页号是从0开
始的，而页表长度至少是1，因此P=M时也会越界）</p>
<p>③页表中页号P对应的页表项地址=页表起始地址F+页号P*页表项长度，取出该页表项内容b，
即为内存块号。（注意区分页表项长度、页表长度、页面大小的区别。页表长度指的是这个页
表中总共有几个页表项，即总共有几个页；页表项长度指的是每个页表项占多大的存储空间；
页面大小指的是一个页面占多大的存储空间）</p>
<p>④计算E=b*L+W，用得到的物理地址E去访存。（如果内存块号、页面偏移量是用二进制表
示的，那么把二者拼接起来就是最终的物理地址了）</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626214609.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626214651.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626214407.png" alt="" /></p>
<h2 id="具有快表的地址变换机构"><a class="header" href="#具有快表的地址变换机构">具有快表的地址变换机构</a></h2>
<p>引入快表后，地址的变换过程</p>
<p>①CPU给出逻辑地址，由某个硬件算得页号、页内偏移量，将页号与快表中的所有页号进行比较。</p>
<p>②如果找到匹配的页号，说明要访问的页表硕在快表中有副本，则直接从中取出该页对应的内存块
号，再将内存块号与页内偏移量拼接形成物理地址，最后，访问该物理地址对应的内存单元。</p>
<p>因此，若快表命中，则访问某个逻辑地址仅需一次访存即可。</p>
<p>③如果没有找到匹配的页号，则需要访问内存中的页表，找到对应页表项，得到页面存放的内存块
号，再将内存块号与页内偏移量拼接形成物理地址，最后，访问该物理地址对应的内存单元。</p>
<p>因此，若快表未命中，则访问某个逻辑地址需要两次访存（注意：在找到页表项后，应同时将其存入快表以便后面可能的再次访问。但若快表已满，则必须按照一定的算法对旧的页表项进行替换)
由于查询快表的速度比查询页表的速度快很多，因此只要快表命中，就可以节省很多时间。</p>
<p>因为局部性原理，一般来说快表的命中率可以达到90%以上。</p>
<p>例：某系统使用基本分页存储管理，并采用了具有快表的地址变换机构。访问一次快表耗时 1us，访问一次内存耗时100微秒。若快表的命中率为 90%，那么访问一个逻辑地址的平均耗时是多少？</p>
<p>有的系统支持快表和慢表同时查找，如果是这样，平均耗时应该是(1+100)*0.9+(100+100)*0.1=110.9 微秒</p>
<p>(1+100) * 0.9 +(1+100+100) * 0.1 = 111 微秒</p>
<p>若未采用快表机制，则访问一个逻辑地址需要100+100=200微秒</p>
<p>显然，引入快表机制后，访问一个逻辑地址的速度快多了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215019.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215052.png" alt="" /></p>
<h2 id="两级页表"><a class="header" href="#两级页表">两级页表</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215151.png" alt="" /></p>
<h2 id="基本分段存储管理方式"><a class="header" href="#基本分段存储管理方式">基本分段存储管理方式</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215339.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215424.png" alt="" /></p>
<p>分段比分页更容易实现信息的共享和保护。</p>
<p>分段、分页管理的对比</p>
<p>页是信息的物理单位。分页的主要目的是为了实现离散分配，提高内存利用率。分页仅仅是系统管
理上的需要，完全是系统行为，对用户是不可见的。</p>
<p>段是信息的逻辑单位。分页的主要目的是更好地满足用户需求。一个段通常包含着一组属于一个逻
辑模块的信息。分段对用户是可见的，用户编程时需要显式地给出段名。</p>
<p>页的大小固定且由系统决定。段的长度却不固定，决定于用户编写的程序。</p>
<p>分页的用户进程地址空间是一维的，程序员只需给出一个记忆符即可表示一个地址。</p>
<p>分段的用户进程地址空间是二维的，程序员在标识一个地址时，既要给出段名，也要给出段内地址。</p>
<p>分段比分页更容易实现信息的共享和保护。不能被修改的代码称为纯代码或可重入代码（不属于临
界资源），这样的代码是可以共享的。可修改的代码是不能共享的</p>
<p>访问一个逻辑地址需要几次访存？</p>
<p>分页（单级页表）：第一次访存一一查内存中的页表，第二次访存一一访问目标内存单元。总共两次访存</p>
<p>分段：第一次访存一一查内存中的段表，第二次访存一一访问目标内存单元。总共两次访存</p>
<p>与分页系统类似，分段系统中也可以引入快表机构，将近期访问过的段表项放到快表中，这样可以
少一次访问，加快地址变换速度。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215646.png" alt="" /></p>
<h2 id="段页式管理方式"><a class="header" href="#段页式管理方式">段页式管理方式</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215718.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215823.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215902.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost03/img/20240626215926.png" alt="" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="存储管理.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="虚拟内存.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="存储管理.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="虚拟内存.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
